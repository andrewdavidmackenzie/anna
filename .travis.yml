#  Copyright 2018 U.C. Berkeley RISE Lab
# 
#  Licensed under the Apache License, Version 2.0 (the "License");
#  you may not use this file except in compliance with the License.
#  You may obtain a copy of the License at
# 
#      http://www.apache.org/licenses/LICENSE-2.0
# 
#  Unless required by applicable law or agreed to in writing, software
#  distributed under the License is distributed on an "AS IS" BASIS,
#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#  See the License for the specific language governing permissions and
#  limitations under the License.

language: rust
sudo: required
dist: trusty

# request macOS 10.15.7
matrix:
  include:
    - os: linux
      rust: stable
    - os: osx
      osx_image: xcode12.2
      rust: stable

compiler:
  - clang

services:
  - docker

env:
  global:
    - PROTOBUF_DIR="$HOME/protobuf"
    - PROTOBUF_VERSION=3.9.1
    - LCOV_VERSION=1.13


addons:
  apt:
    packages:
      - libzmq3-dev

cache:
  directories:
    - $PROTOBUF_DIR

branches:
  only:
    - "master"

install:
  - ./common/scripts/travis/travis-install.sh
  - rustup --quiet component add clippy

script:
  - ./scripts/travis/travis-build.sh
  - cargo clippy
  - cargo test

after_success:
  - ./scripts/travis/upload-codecov.sh
  - ./scripts/travis/docker-build.sh
